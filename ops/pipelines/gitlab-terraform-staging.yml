image:
  name: "$CI_TEMPLATE_REGISTRY_HOST/gitlab-org/terraform-images/stable:latest"

cache:
  key: tf
  paths:
    - ops/infrastructure/envs/staging/.terraform
    - ops/infrastructure/envs/staging/.terraform.lock.hcl

before_script:
  - mkdir -pv ops/infrastructure/envs/staging


init:
  stage: staging terraform
  script:
    - pwd
    - ls -al
    - cd ops/infrastructure/envs/staging
    - pwd
    - ls -al

validate:
  stage: staging terraform
  script:
    - cd ops/infrastructure/envs/staging

plan:
  stage: staging terraform
  script:
    - cd ops/infrastructure/envs/staging

apply:
  stage: staging terraform
  script:
    - cd ops/infrastructure/envs/staging
  when: manual

destroy:
  stage: staging terraform
  script:
    - cd ops/infrastructure/envs/staging
  when: manual
