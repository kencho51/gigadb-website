test_files_url_updater:
  variables:
    COMPOSE_FILE: "docker-compose.yml"

  stage: test
  artifacts:
    paths:
      - gigadb/app/tools/files-url-updater/runtime/logs/app.log
      - gigadb/app/tools/files-url-updater/tests/_output
      - gigadb/app/tools/files-url-updater/drop_restore.log
      - gigadb/app/tools/files-url-updater/config/params.php
      - gigadb/app/tools/files-url-updater/composer.json
      - gigadb/app/tools/files-url-updater/composer.lock
    when: always
    expire_in: 1 week
  script:
    - cd gigadb/app/tools/files-url-updater
    - docker-compose run --rm updater composer install
    - docker-compose up -d pg9_3
    - docker-compose run --rm updater ./yii dataset-files/download-restore-backup --default
    - docker-compose run --rm updater ./vendor/bin/codecept build
    - docker-compose run --rm updater ./vendor/bin/codecept run